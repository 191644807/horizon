
<link jumptag="time">

<template id="tile" type="jumptag">
  <div class="tile ${opts.class}">
    <div class="inner">
      <div class="content"><expand /></div>
      <div class="caption">${opts.caption}</div>
    </div>
  </div>
</template>

<template id="tiles" type="jumptag">
  <script>
    let {clients, collections, cursors} = opts.data;
  </script>
  
  <div class="tiles">
    <tile caption="Clients" class="clients">
      <i class="icon ion-ios-person"></i>
      <div class="value">${clients.length}</div>
    </tile>

    <tile caption="Collections" class="collections">
      <i class="icon ion-ios-copy"></i>
      <div class="value">${collections.length}</div>
    </tile>

    <tile caption="Requests" class="requests">
      <i class="icon ion-ios-pulse"></i>
      <div class="value">${cursors.length}</div>
    </tile>
  </div>
</template>

<template id="dashboard" type="jumptag">
  <script>
    let {model: {graph}, data: {clients, requests}} = opts;
  </script>
  
  <div id="dashboard" class="epoch-theme-default">

    <tiles data={opts.data}></tiles>

    <div class="graph-container">
      <update check="{!graph}">
        <div id="graph" class="epoch"></div>
        <script>opts.model.initializeGraph();</script>
      </update>
    </div>

    <div class="box">
      <div class="title requests">
        <h2><i class="icon ion-ios-pulse"></i> Recent Requests</h2>
      </div>

      <table>
        <tr>
          <th>Command</th>
          <th></th>
          <th>Client</th>
          <th></th>
          <th>Collection</th>
          <th></th>
          <th>Time</th>
        </tr>
        <for var="req" in={requests.slice(0,5)}>
          <tr key="{`${req.id[0]}-${req.id[1]}`}" class="item">
            <td class="token requests ${req.raw.type}">
                <i class="icon ion-ionic icon-${req.raw.type}"></i>
                <span class="text">${req.raw.type}</span>
              </span>
            </td>
            <td class="between">by</td>
            <td class="token clients">
              <i class="icon ion-ios-person"></i>
              <span class="text">${req.client.ip}</span>
            </td>
            <td class="between">on</td>
            <td class="collections token">
              <i class="icon ion-ios-copy"></i>
              <span class="text">${req.raw.options.collection}</span>
            </td>
            <td class="between">at</td>
            <td class="token timestamp">
              <span class="text">
                <i class="icon ion-ios-clock"></i>
                <time time={req.time} format="MMM D hh:mm a"></time>
              </span>
            </td>
          </tr>
        </for>
      </table>
      
      
      <div class="box">
      <div class="title clients">
        <h2><i class="icon ion-ios-person"></i> Recent Clients</h2>
      </div>
      
      <table>
        <tr>
          <th>Address</th>
          <th></th>
          <th>Origin</th>
          <th></th>
          <th>Time</th>
        </tr>
        <for var="client" in={clients.slice(0,10)}>
          <tr key="{`${client.id}-recent-client`}" class="item">
            <td class="token clients">
              <i class="icon ion-ios-person"></i>
              <span class="text">${client.ip}</span>
            </td>
            <td class="between">from</td>
            <td class="token collections">
              <span class="text">${client.origin}</span>
            </td>
            <td class="between">at</td>
            <td class="token timestamp">
              <span class="text">
                <i class="icon ion-ios-clock"></i>
                <time time={client.time} format="MMM D hh:mm a"></time>
              </span>
            </td>
          </tr>
        </for>
      </table>

    </div>
  </div>
</template>
