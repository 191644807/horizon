## Customize the test machine
machine:

  post:
    - source /etc/lsb-release && echo "deb http://download.rethinkdb.com/apt $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/rethinkdb.list
    - wget -qO- https://download.rethinkdb.com/apt/pubkey.gpg | sudo apt-key add -
    - sudo apt-get update -o Dir::Etc::sourcelist="/etc/apt/sources.list.d/rethinkdb.list" -o Dir::Etc::sourceparts="-" -o APT::Get::List-Cleanup="0"
    - sudo apt-get install rethinkdb

## Customize dependencies
dependencies:
  # Cache directories for speed
  cache_directories:
    - client/node_modules
    - server/node_modules
    - cli/node_modules
  override:
    - ./setupDev.sh:
        pwd: test

## Customize test commands
test:
  pre:
    - ./test/serve.js:
        background: true
  override:
    # Switch to node v4.3.0
    - nvm use v4.3.0
    # Run client tests
    - ./node_modules/.bin/mocha --timeout 100000 dist/test.js:
        pwd: client
        parallel: true
    # Run server tests
    - ./node_modules/.bin/mocha --timeout 100000:
        pwd: server
        parallel: true
        files: 
            - test/test.js
            - test/schema.js 
    # Run cli tests
    - ./node_modules/.bin/mocha --timeout 100000:
        pwd: cli
        parallel: true
        files:
            - test/**/*.js
    # Switch to v5.7.0
    - nvm use v5.7.0
    # Run client tests
    - ./node_modules/.bin/mocha --timeout 100000 dist/test.js:
        pwd: client
        parallel: true
    # Run server tests
    - ./node_modules/.bin/mocha --timeout 100000:
        pwd: server
        parallel: true
        files: 
            - test/test.js
            - test/schema.js 
    # Run cli tests
    - ./node_modules/.bin/mocha --timeout 100000:
        pwd: cli
        parallel: true
        files:
            - test/**/*.js
    - nvm use v6.1.0
    # Run client tests
    - ./node_modules/.bin/mocha --timeout 100000 dist/test.js:
        pwd: client
        parallel: true
    # Run server tests
    - ./node_modules/.bin/mocha --timeout 100000:
        pwd: server
        parallel: true
        files: 
            - test/test.js
            - test/schema.js 
    # Run cli tests
    - ./node_modules/.bin/mocha --timeout 100000:
        pwd: cli
        parallel: true
        files:
            - test/**/*.js
